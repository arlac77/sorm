#!/usr/bin/env node

"use strict";

var commander= require('commander')
   ,fs       = require('fs')
   ,os       = require("os")
   ,util     = require('util')
   ,path     = require('path')
   ,async    = require('async')
   ,pkginfo  = require('pkginfo')(module, 'name', 'version')
   ,sqlite3  = require('sqlite3')
   ,winston  = require('winston')
   ,schema   = require('../lib/schema.js');


winston.cli();

commander
  	.version(module.exports.version)
	.option('--database <file>', 'sqlite3 database file')
	.option('--schema <file>', 'schema definition file')
  	.parse(process.argv);


var s  = schema.Schema(commander.schema);
var db = new sqlite3.Database(commander.database);

s.load_ddl_from_db(db,function(error) {
	
	s.save(function(error) {
		if(error)
			winston.error("save error", error);
		else
			winston.info("saved", s.basedir);
	});
});